<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Prolific Dyadic Chat</title>
    <script src="/socket.io/socket.io.js"></script>

    <!-- jsPsych core -->
    <script src="https://unpkg.com/jspsych@7.3.3/dist/index.browser.js?v=core"></script>
    <link rel="stylesheet" href="https://unpkg.com/jspsych@7.3.3/dist/style.css?v=core">

    <!-- Local plugins -->
    <script src="/plugins/jspsych-survey-html-form-lite.js?v=v7class"></script>
    <script src="/plugins/jspsych-instructions-lite.js?v=v7class"></script>
    <script src="/plugins/jspsych-dyadic-chat.js?v=vG6h-uipatch3d"></script>

    <style>
      body { margin:0; background:#000; color:#fff; font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
      .jspsych-content { color:#fff; }
      .jspsych-btn { background:#1f1f22; color:#fff; border:1px solid #555; border-radius:10px; padding:10px 14px; }
      a, p, li, h1, h2, h3 { color:#fff; }
      .consent-box { margin-top:20px; max-height:55vh; overflow:auto; padding:12px; border:1px solid #444; border-radius:10px; background:#0b0b0b; text-align:left; }
      .consent-actions { margin-top:12px; }
      .consent-actions label { display:flex; align-items:center; gap:8px; }
      .instr { text-align:left; max-width:900px; margin:0 auto; }
      .instr ul { line-height:1.5; }
      .instr h2 { margin-top:0; }
      .instr-page-top { margin-top: 24px; }
  .consent-box h2 { margin: 0 0 12px 0; }
</style>
  </head>
  <body>
    <script>
      const jsPsych = initJsPsych();

      const CONSENT_HTML = `
        <div class="consent-box">
          <h2>Consent</h2>
          <p>Please read the study information below. By checking the box, you confirm that you are 18+, and consent to participate.</p>
          <ul>
            <li>Your chat and answers will be recorded for research.</li>
            <li>Do not share any personal or identifying information.</li>
            <li>You may withdraw at any time by closing the window.</li>
          </ul>
          <div class="consent-actions">
            <label><input type="checkbox" name="consent" required> I have read the information and I consent to participate.</label>
          </div>
        </div>`;

      const INSTRUCTIONS_PAGE_HTML = `\
        <div class="instr instr-aesthetic" style="margin-top:28px;">
          <style>
            .instr-aesthetic .nice { margin: 0; padding-left: 1.2em; line-height: 1.6; }
            .instr-aesthetic li { margin: 6px 0; }
            .instr-aesthetic ol[type="a"] { margin-top: 6px; }
            .instr-aesthetic h2 { margin-bottom: 10px; }
            .instr-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin: 26px 0 18px 0; }
            .instr-ph {
              background: #0e0e10;
              border: 1px solid #555;
              border-radius: 10px;
              height: 260px;
              color: #cfcfcf;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 16px;
              letter-spacing: 0.2px;
            }
            @media (max-width: 900px) {
              .instr-grid { grid-template-columns: 1fr; }
              .instr-ph { height: 200px; }
            }
          </style>
          <h2>Instructions</h2>
          <ol class="nice">
            <li>You and your partner will each see different views of the same room.</li>
            <li>You have to chat and collaborate with your partner in order to solve the question correctly.</li>
            <li>You can submit an answer only after the required number of turns is completed.</li>
            <li>Strict turn-taking:
              <ol type="a">
                <li>Send a message only after your partner replies.</li>
                <li>No two consecutive messages from the same person.</li>
              </ol>
            </li>
            <li>You may zoom in on the image to inspect details.</li>
            <li>After the turns are completed, select the option you think is correct and click “Submit Answer”.</li>
            <li>Do not share personal information.</li>
          </ol>

          <div class="instr-grid">
            <div class="instr-ph">PlaceHolder Image 1</div>
            <div class="instr-ph">PlaceHolder Image 2</div>
          </div>

          <p>Click "Start chat" when you are ready.</p>
        </div>
`;
const SIDEBAR_INSTR_HTML = `\
<div class="instr instr-aesthetic">
  <style>
    .instr-aesthetic .nice { margin: 0; padding-left: 1.2em; line-height: 1.6; }
    .instr-aesthetic li { margin: 6px 0; }
    .instr-aesthetic ol[type="a"] { margin-top: 6px; }
    .instr-aesthetic h2 { margin-bottom: 10px; }
    .consent-box h2 { margin: 0 0 12px 0; }
</style>
  <h2>Instructions</h2>
  <ol class="nice">
    <li>You and your partner will each see different views of the same room.</li>
    <li>You have to chat and collaborate with your partner in order to solve the question correctly.</li>
    <li>You can submit an answer only after the required number of turns is completed.</li>
    <li>Strict turn-taking:
      <ol type="a">
        <li>Send a message only after your partner replies.</li>
        <li>No two consecutive messages from the same person.</li>
      </ol>
    </li>
    <li>You may zoom in on the image to inspect details.</li>
    <li>After the turns are completed, select the option you think is correct and click “Submit Answer”.</li>
    <li>Do not share personal information.</li>
  </ol>
</div>
`;
const consentTrial = { type: jsPsychSurveyHtmlForm, html: CONSENT_HTML, button_label: "Continue" };
      const instructionsTrial = { type: jsPsychInstructions, pages: [INSTRUCTIONS_PAGE_HTML], show_clickable_nav: true, button_label_next: "Start chat", button_label_previous: "Back" };
      const chatTrial = {
        type: jsPsychDyadicChat,
        socketUrl: window.location.origin,
        prolific: { PID: 'DEBUG_LOCAL' },
        min_turns: 10,
        goal_question: '',
        answer_options: ['A','B','C','D'],
        wait_timeout_sec: 120,
        instructions_html: SIDEBAR_INSTR_HTML,
        image_url: ''
      };

      jsPsych.run([consentTrial, instructionsTrial, chatTrial]);
    </script>
  </body>
</html>
